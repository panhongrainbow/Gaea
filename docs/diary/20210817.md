# 2021年08月17日 开发日志

> 考量的点在于如何集中单元测试的函式，集中到那个地方？

## 问题和解决方案

### [问题1] 是否要把单元测试的函式集中成一个包？

#### [解决方案说明1]

在 8 月 17 日之前，是先把单元测试的先做到直接数据库 DC 的那个位置，现在问题来了，如果今天 Plan 要进行单元测试，有以下几个做法

1. Plan 告知 Session Executor 要进行单元测试，再由 Session Executor 告知 DC 要进行单元测试，最后由 DC 执行单元测试，要一个传一个，很麻烦，此为 [经由传送后执行的方法]
2. 每一个资料，像 Plan、Session Executor 和 DC，都可以自行执行单元测试，但这会有个问题，但个地方都可以执行单元测试，会很乱，此为 [各自独立运作的方法]
3. 把目前 DC 的单元测试的函式集中在一个包，其他资料，像 Plan、Session Executor 和 DC，都可以自行去触发，但是最后执行单元测试还是要由 DC 去执行，此为 [独立做成包的方法]
4. 直接在 DC 上做开关，利用开关去触发单元测试，这个方法以目前来说，是最简单的，以现在的程式码状态就可以直接进行修改，此为  [由开关去触发的方法]

### [问题2] 考虑以上方案对于 载入回圈 (import cycle) 、效能和维护上的问题？

对以下上述可能会发生的问题进行分析

| 方案                 | 载入回圈问题 | 效能问题 | 维护问题     |
| -------------------- | ------------ | -------- | ------------ |
| 经由传送后执行的方法 |              |          | 主要是很麻烦 |
| 各自独立运作的方法   |              |          | 主要是很乱   |
| 独立做成包的方法     | 应不会发生   | 不能上锁 | 简易         |
| 由开关去触发的方法   | 应不会发生   | 不能上锁 | 更简易       |

上面有提到在效能上，决定使用不上锁的原因，主要的考量是现今不想因为单元测试去影响主程式的效能，如果今天在 DC 或单元测试的包上锁，会变成每一次进行数据库直连 DC 时，都会面临上锁的状况而影响效能。另外如果今天真的必要要在单元测试进行上锁，那就用 time Sleep 先暂停一下去解决吧

### [最后结论] 要决定进行的方案

最后决定，以方案4 [由开关去触发的方法 ] 去进行处理，在数据库直连 DC 上直接做开关，并不对开关进行上锁，把对主程式效能上的影响降到最低，主要采用的原因是因为最容易维护

















