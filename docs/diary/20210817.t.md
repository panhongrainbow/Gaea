# 2021年08月17日 開發日誌

> 考量的點在於如何集中單元測試的函式，集中到那個地方？

## 問題和解決方案

### [問題1] 是否要把單元測試的函式集中成一個包？

#### [解決方案說明1]

在 8 月 17 日之前，是先把單元測試的先做到直接數據庫 DC 的那個位置，現在問題來了，如果今天 Plan 要進行單元測試，有以下幾個做法

1. Plan 告知 Session Executor 要進行單元測試，再由 Session Executor 告知 DC 要進行單元測試，最後由 DC 執行單元測試，要一個傳一個，很麻煩，此為 [經由傳送後執行的方法]
2. 每一個資料，像 Plan、Session Executor 和 DC，都可以自行執行單元測試，但這會有個問題，但個地方都可以執行單元測試，會很亂，此為 [各自獨立運作的方法]
3. 把目前 DC 的單元測試的函式集中在一個包，其他資料，像 Plan、Session Executor 和 DC，都可以自行去觸發，但是最後執行單元測試還是要由 DC 去執行，此為 [獨立做成包的方法]
4. 直接在 DC 上做開關，利用開關去觸發單元測試，這個方法以目前來說，是最簡單的，以現在的程式碼狀態就可以直接進行修改，此為  [由開關去觸發的方法]

### [問題2] 考慮以上方案對於 載入迴圈 (import cycle) 、效能和維護上的問題？

對以下上述可能會發生的問題進行分析

| 方案                 | 載入迴圈問題 | 效能問題 | 維護問題     |
| -------------------- | ------------ | -------- | ------------ |
| 經由傳送後執行的方法 |              |          | 主要是很麻煩 |
| 各自獨立運作的方法   |              |          | 主要是很亂   |
| 獨立做成包的方法     | 應不會發生   | 不能上鎖 | 簡易         |
| 由開關去觸發的方法   | 應不會發生   | 不能上鎖 | 更簡易       |

上面有提到在效能上，決定使用不上鎖的原因，主要的考量是現今不想因為單元測試去影響主程式的效能，如果今天在 DC 或單元測試的包上鎖，會變成每一次進行數據庫直連 DC 時，都會面臨上鎖的狀況而影響效能。另外如果今天真的必要要在單元測試進行上鎖，那就用 time Sleep 先暫停一下去解決吧

### [最後結論] 要決定進行的方案

最後決定，以方案4 [由開關去觸發的方法 ] 去進行處理，在數據庫直連 DC 上直接做開關，並不對開關進行上鎖，把對主程式效能上的影響降到最低，主要採用的原因是因為最容易維護

















