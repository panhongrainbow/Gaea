 # 2021年11月09日 開發日誌

> - 在 Gaea 程式碼裡，有看到程式碼，看似是防止資料由 Stack 逃脫到記憶體上

## 1 sink 函式

在 Gaea/parser/tidb-types/datum.go 檔案裡，有 sink 函式

<img src="../assets/panhongrainbow/image-20211109115436714.png" alt="image-20211109115436714" style="zoom:80%;" /> 

當 SetString 函式把執行到一半時，會呼叫 sink 函式，s 字串變數會 sink 函式的參數，s 字串變數就會被強制鎖在 棧 Stack 裡面，不會挑脫到 堆裡

可能是在考量如果 s 字串變數過長，就會被 Golang 分配到 堆 Heap ，但是經由 sink 函式可以強迫 s 字串變數 留在 棧上

當退出函式時，s 字串變數也會跟著被清除，GC 就不需要去做任何後續處理，以增加效能

## 2 觀念證明

